try{const e=document.querySelector("html"),t="data-platform";if(navigator.userAgentData&&navigator.userAgentData.platform){const n=navigator.userAgentData.platform.toLowerCase();n.includes("linux")?e.setAttribute(t,"linux"):n.includes("windows")?e.setAttribute(t,"windows"):n.includes("mac")&&e.setAttribute(t,"macos")}else if(navigator.platform){const n=navigator.platform.toLowerCase();n.includes("linux")?e.setAttribute(t,"linux"):n.includes("win")?e.setAttribute(t,"windows"):n.includes("mac")&&e.setAttribute(t,"macos")}}catch(e){console.warn("Failed to detect platform:",e)}function theme_spinner(e,t,n){const r="cspinner_container";if(e=e||(document.querySelector("button i.fa-sign-in:not(.invisible)")||document.querySelector("button i.fa-qrcode:not(.invisible)")),s='<span class="'+r+'"><span class="cspinner"><span class="cspinner-icon white small"></span></span></span>',e&&!t)e.classList.add("invisible"),e.insertAdjacentHTML("afterend",s),e.parentNode.classList.add("disabled"),e.parentNode.disabled=!0;else if(e&&t){e.classList.remove("invisible"),e.parentNode.classList.remove("disabled"),e.parentNode.disabled=!1;const t=e.parentNode.querySelector("."+r);t&&t.parentNode.removeChild(t),n&&(e.className="fa2 fa2-marker-check",e.parentNode.classList.add("disabled"))}}function theme_content_loaded(){const e="object"==typeof theme_language?theme_language:{},t=".container.session_login",n=".session_login_back.forgot",r=document.querySelector('input[name="user"]'),o=document.querySelector('input[name="pass"]'),s=function(e,t){const n=(e?"faa-bounce animated":"faa-horizontal animated").split(" ");t.classList.add(...n),setTimeout(()=>{t.classList.remove(...n)},1500)};document.querySelectorAll('input[type="password"]').forEach(e=>{const t=document.createElement("span");t.classList.add("input_warning_caps"),t.setAttribute("title","Caps Lock"),t.classList.add("large"),e.classList.add("use_input_warning_caps"),e.parentNode.insertBefore(t,e.nextSibling),e.addEventListener("blur",function(){this.nextSibling.classList.remove("visible")}),e.addEventListener("keydown",function(e){if("function"==typeof e.getModifierState){let t;t=20===e.keyCode?!e.getModifierState("CapsLock"):e.getModifierState("CapsLock"),t?this.nextSibling.classList.add("visible"):this.nextSibling.classList.remove("visible")}})}),function(){const n=document.querySelector('[name="twofactor"]');if(n){const i=document.querySelector('[data-submit="2fa"]'),a=i.querySelector("i"),c=i.getAttribute("data-prefix"),l=location.origin+(c||""),u=document.querySelector('[name="save"]'),d=n.closest("form"),f=d.getAttribute("action")||url.toString(),p=function(i){i.preventDefault(),theme_spinner(a);const c=new URLSearchParams;c.append("user",r.value),c.append("pass",o.value),u&&c.append("save",u.checked?1:0),c.append("twofactor",n.value),fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}).then(t=>{if(t.url&&(m=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(e=>{const n=(new DOMParser).parseFromString(e,"text/html");if(n.querySelector(t)){theme_spinner(a,!0);const e=document.querySelector(t);e.querySelectorAll(".alert").forEach(e=>e.remove());const r=n.querySelector(".alert");return void(r&&(e.insertBefore(r.cloneNode(!0),e.firstChild),s(!1,e.querySelector(".alert"))))}location.href=m}).catch(e=>{location.href=m})};let m=l;n&&n.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),i&&i.click(),!1}),d.addEventListener("submit",function(s){s.preventDefault();const a=new URLSearchParams;a.append("user",r.value),a.append("pass",o.value),u&&a.append("save",u.checked?1:0),a.append("twofprobe",1),fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(t=>{if(t.url&&(m=t.url),401===t.status)return{needsTwoFactor:!0};if(t.ok)return t.text().then(e=>({needsTwoFactor:!1,htmlResponse:e}));throw new Error(e.session_neterror)}).then(e=>{if(e.needsTwoFactor){const e=document.querySelector(".session_login_flipper");e.classList.toggle("flipped"),e.classList.toggle("twofactor");const t=document.querySelector(".alert");return t&&t.remove(),setTimeout(()=>{n.focus()},600),i.removeEventListener("click",p),void i.addEventListener("click",p)}{const n=e.htmlResponse,r=(new DOMParser).parseFromString(n,"text/html"),s=document.querySelector(t),i=r.querySelector(t);if(s&&i)return s.innerHTML=i.innerHTML,theme_content_loaded(),void setTimeout(()=>{o.focus()});location.href=m}}).catch(e=>{console.warn("Request failed:",e),location.href=m})})}}(),function(){const i=document.querySelector(n+" .form-signin-group > .btn-success"),a=document.querySelector(".session_login_flipper"),c=a.querySelectorAll("[data-flipper]"),l=document.querySelector(n+' input[name="forgot"]'),u=document.querySelector(n+" [data-unlocker]"),d=document.querySelector(n+' input[name="newpass"]'),f=document.querySelector(n+' input[name="newpass2"]'),p=l&&l.dataset&&l.dataset.return,m=d&&d.dataset&&d.dataset.return,h=t,v=function(){const e=a,t=e.classList.contains("forgot");!t&&e.classList.toggle("flipping",!0),!t&&e.classList.toggle("forgot",!0),setTimeout(()=>{t&&e.classList.toggle("flipping",!1),t&&e.classList.toggle("forgot",!1)},600),e.classList.toggle("flipped");const n=e.classList.contains("flipped")?document.querySelector('input[name="forgot"]'):r;n&&setTimeout(()=>{e.classList.contains("flipped")||!n.value.trim()?n.focus():o&&o.focus()},600)},g=function(e){let t=e.querySelector(".panel-body > [data-fatal-error-text]");return t&&t.textContent.trim()||(t=e.querySelector(".panel-body > .err-content")),t},w=function(t,n,r){let o=document.querySelector(h+" > .alert");o&&o.remove(),o=document.createElement("div"),o.className="alert",o.innerHTML='\n                    <strong><i class="fa"></i> </strong><br>\n                    <span></span>';const i=document.querySelector(h);i&&i.insertBefore(o,i.firstChild),o.classList.remove("alert-warning","alert-success","alert-danger");const a=o.querySelector(".fa"),c=o.querySelector("strong"),l=o.querySelector("span");"success"===t?(s(!0,o),o.classList.add("alert-success"),r||(r="check-circle"),a&&(a.className="fa fa-"+r),c&&(c.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_success),l&&(l.innerHTML=n)):(s(!1,o),o.classList.add("alert-danger"),r||(r="exclamation-circle"),a&&(a.className="fa fa-"+r),c&&(c.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_error),l&&(l.textContent=n))};if(p&&setTimeout(()=>{v()},60),c&&c.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.dataset.webmin;if(t){const e=(location.origin+location.pathname.replace(/\/[^\/]*\.[^\/]*$/,"")).replace(/\/$/,""),n=encodeURIComponent(e);return void(location.href=`${t}?return=${n}`)}if(p||m)return e.stopImmediatePropagation(),void(location.href=p||m);v()})}),l&&l.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),i&&i.click(),!1}),d&&(d.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),f&&f.focus(),!1}),f&&f.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),u&&u.click(),!1})),i&&i.addEventListener("click",function(t){if(t.preventDefault(),this.classList.contains("disabled"))return;if(!l||!l.value.trim())return void w("error",e.session_cannot);const n=l.value.trim(),r=this.querySelector("i");theme_spinner(r);let o=`forgot=${encodeURIComponent(n)}`;p&&(o+=`&return=${encodeURIComponent(p)}`),fetch("forgot_send.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:o}).then(t=>{if(t.url&&(serverRedirectUrl=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html"),o=n.querySelector(".panel-body > center");if(o&&o.textContent.trim())return theme_spinner(r,!0,!0),void w("success",o.innerHTML.trim());theme_spinner(r,!0);const s=g(n);if(s&&s.textContent.trim())return w("error",s.textContent.trim()),void l.focus();w("error",e.session_unkerror)}).catch(t=>{theme_spinner(r,!0),console.warn("Request failed:",t),w("error",e.session_conerror)})}),u){const t=document.querySelector(n),s=function(){t.remove(),function(){const e=new URL(window.location.href);e.search="",history.replaceState({},document.title,e)}();const e=document.querySelector(h+" .alert");e&&e.remove(),location.reload()};c.length>1&&c[1].addEventListener("click",function(e){e.preventDefault(),s()}),d&&setTimeout(()=>{d.focus()},0),u.addEventListener("click",function(n){if(n.preventDefault(),this.classList.contains("disabled"))return;if(!d||!d.value.length)return void w("error",e.session_resetepassreq);if(!f||!f.value.length)return void w("error",e.session_pwdconf);const s=d.value,i=f.value;if(s!==i)return void w("error",e.session_pwdmatch);const a=t?t.getAttribute("data-forgot"):null,l=t?t.getAttribute("data-username"):null;if(!a)return void w("error",e.session_noid);const u=this.querySelector("i");theme_spinner(u),fetch("forgot.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`id=${encodeURIComponent(a)}&newpass=${encodeURIComponent(s)}&newpass2=${encodeURIComponent(i)}`}).then(t=>{if(t.url&&(serverRedirectUrl=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(n=>{const s=(new DOMParser).parseFromString(n,"text/html"),i=g(s);if(i&&i.textContent.trim())return theme_spinner(u,!0),void w("error",i.textContent.trim());if(m){const e=encodeURIComponent(t.getAttribute("data-username"));return void(location.href=`${m}?returned-username=${e}`)}theme_spinner(u,!0,!0),c[0].click(),w("success",e.session_pwdsucc,"unlock");const a=new URL(window.location.href);a.search="",history.replaceState({},document.title,a),l&&(r.value=l,o&&o.focus())}).catch(t=>{theme_spinner(u,!0),console.warn("Request failed:",t),w("error",e.session_conerror)})})}}(),function(){const e=document.querySelectorAll(t+" > .alert");e&&e.forEach(e=>{setTimeout(()=>{e.classList.remove("animated")},1500)})}(),o&&o.hasAttribute("autofocus")&&setTimeout(()=>{o.focus()},0),r&&r.hasAttribute("autofocus")&&setTimeout(()=>{r.focus()},0)}document.addEventListener("DOMContentLoaded",theme_content_loaded);